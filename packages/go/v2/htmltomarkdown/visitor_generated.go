//go:build disabled
// +build disabled

// Code generated by generate_visitor_callbacks.py; DO NOT EDIT.
// This file contains the FFI callback layer for a new visitor pattern implementation.
// It is currently disabled (see build tag above) until the visitor API is finalized.
//
// Generator: scripts/generate_visitor_callbacks.py
// Schema: crates/html-to-markdown-ffi/visitor_callbacks.yaml
// Template: crates/html-to-markdown-ffi/templates/go_bridge_callbacks.go.j2

package htmltomarkdown

/*
#include <stdlib.h>
#include <stdbool.h>
#include <stdint.h>
#include <string.h>

#ifndef HTML_TO_MARKDOWN_TYPES_H
#define HTML_TO_MARKDOWN_TYPES_H

// Result type enumeration (matching FFI HtmlToMarkdownVisitResultType)
typedef enum {
    HTML_TO_MARKDOWN_VISIT_CONTINUE = 0,
    HTML_TO_MARKDOWN_VISIT_CUSTOM = 1,
    HTML_TO_MARKDOWN_VISIT_SKIP = 2,
    HTML_TO_MARKDOWN_VISIT_PRESERVE_HTML = 3,
    HTML_TO_MARKDOWN_VISIT_ERROR = 4
} HtmlToMarkdownVisitResultType;

// Forward declarations for C types
typedef struct {
    uint32_t node_type;
    const char* tag_name;
    const char* parent_tag;
    size_t depth;
    size_t index_in_parent;
    bool is_inline;
    bool is_first_child;
    bool is_last_child;
    bool has_siblings;
} html_to_markdown_node_context_t;

typedef struct {
    uint32_t result_type;
    char* custom_output;
    char* error_message;
} html_to_markdown_visit_result_t;

#endif // HTML_TO_MARKDOWN_TYPES_H
*/
import "C"
import (
	"unsafe"
)

// ElementStartCallback wraps the user's Go callback for element_start.
//
// Called before entering any HTML element (pre-order traversal)
// HTML elements: All elements
//
//export goElementStartCallback
func goElementStartCallback(
	userData unsafe.Pointer,
	ctx *C.html_to_markdown_node_context_t,) C.html_to_markdown_visit_result_t {
	// Extract the visitor from user data
	if userData == nil {
		return continueResult()
	}

	visitor := (*Visitor)(userData)
	if visitor.ElementStart == nil {
		return continueResult()
	}

	// Convert C types to Go types
	goCtx := &NodeContext{
		NodeType:   NodeType(ctx.node_type),
		TagName:    C.GoString(ctx.tag_name),
		Depth:      int(ctx.depth),
		IsFirstChild: bool(ctx.is_first_child),
		IsLastChild:  bool(ctx.is_last_child),
		HasSiblings:  bool(ctx.has_siblings),
	}
	// Call the user's Go callback
	result := visitor.ElementStart(
		goCtx,	)

	// Convert Go VisitResult to C result
	return visitResultToC(result)
}

// LineBreakCallback wraps the user's Go callback for line_break.
//
// Called for line break elements
// HTML elements: <br>, <br/>
//
//export goLineBreakCallback
func goLineBreakCallback(
	userData unsafe.Pointer,
	ctx *C.html_to_markdown_node_context_t,) C.html_to_markdown_visit_result_t {
	// Extract the visitor from user data
	if userData == nil {
		return continueResult()
	}

	visitor := (*Visitor)(userData)
	if visitor.LineBreak == nil {
		return continueResult()
	}

	// Convert C types to Go types
	goCtx := &NodeContext{
		NodeType:   NodeType(ctx.node_type),
		TagName:    C.GoString(ctx.tag_name),
		Depth:      int(ctx.depth),
		IsFirstChild: bool(ctx.is_first_child),
		IsLastChild:  bool(ctx.is_last_child),
		HasSiblings:  bool(ctx.has_siblings),
	}
	// Call the user's Go callback
	result := visitor.LineBreak(
		goCtx,	)

	// Convert Go VisitResult to C result
	return visitResultToC(result)
}

// continueResult returns a Continue result.
func continueResult() C.html_to_markdown_visit_result_t {
	return C.html_to_markdown_visit_result_t{
		result_type:   C.HTML_TO_MARKDOWN_VISIT_CONTINUE,
		custom_output: nil,
		error_message: nil,
	}
}

// visitResultToC converts a Go VisitResult to C representation.
func visitResultToC(result VisitResult) C.html_to_markdown_visit_result_t {
	switch result.Type {
	case VisitContinue:
		return C.html_to_markdown_visit_result_t{
			result_type:   C.HTML_TO_MARKDOWN_VISIT_CONTINUE,
			custom_output: nil,
			error_message: nil,
		}
	case VisitCustom:
		return C.html_to_markdown_visit_result_t{
			result_type:   C.HTML_TO_MARKDOWN_VISIT_CUSTOM,
			custom_output: C.CString(result.CustomOutput),
			error_message: nil,
		}
	case VisitSkip:
		return C.html_to_markdown_visit_result_t{
			result_type:   C.HTML_TO_MARKDOWN_VISIT_SKIP,
			custom_output: nil,
			error_message: nil,
		}
	case VisitPreserveHTML:
		return C.html_to_markdown_visit_result_t{
			result_type:   C.HTML_TO_MARKDOWN_VISIT_PRESERVE_HTML,
			custom_output: nil,
			error_message: nil,
		}
	case VisitError:
		return C.html_to_markdown_visit_result_t{
			result_type:   C.HTML_TO_MARKDOWN_VISIT_ERROR,
			custom_output: nil,
			error_message: C.CString(result.ErrorMessage),
		}
	default:
		return continueResult()
	}
}
