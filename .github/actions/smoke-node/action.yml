name: Smoke test Node package
description: Tests Node.js package installation and functionality

inputs:
  node-tarball:
    description: Path to the Node.js package tarball
    required: true

runs:
  using: composite
  steps:
    - name: Smoke Node install
      shell: bash
      run: |
        set -euo pipefail
        tmp=$(mktemp -d)
        cp -R examples/node-smoke/. "$tmp"/
        pushd "$tmp" >/dev/null
        cp "${{ inputs.node-tarball }}" ./node.tgz
        node -e "const fs=require('fs');const pkg=JSON.parse(fs.readFileSync('package.json','utf8'));pkg.dependencies=pkg.dependencies||{};pkg.dependencies['html-to-markdown-node']='file:./node.tgz';fs.writeFileSync('package.json',JSON.stringify(pkg,null,2)+ '\n');"
        rm -f pnpm-lock.yaml
        pnpm install --no-frozen-lockfile
        pnpm run check
        popd >/dev/null
        echo "âœ“ Node package smoke test passed"
