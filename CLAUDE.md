<!--
ðŸ¤– GENERATED FILE - DO NOT EDIT DIRECTLY
===========================================

This file was automatically generated by ai-rulez from ai-rulez.yaml.

âš ï¸  IMPORTANT FOR AI ASSISTANTS AND DEVELOPERS:
- DO NOT modify this file directly
- DO NOT add, remove, or change rules in this file
- Changes made here will be OVERWRITTEN on next generation

âœ… TO UPDATE RULES:
1. Edit the source configuration: ai-rulez.yaml
2. Regenerate this file: ai-rulez generate
3. The updated CLAUDE.md will be created automatically

ðŸ“ Generated: 2025-10-06 17:10:21
ðŸ“ Source: ai-rulez.yaml
ðŸŽ¯ Target: CLAUDE.md
ðŸ“Š Content: 6 rules, 3 sections

Learn more: https://github.com/Goldziher/ai-rulez
===========================================
-->

# html-to-markdown

High-performance HTML to Markdown converter. Rust crate with Python bindings (PyO3) and native CLI. Built with html5ever and ammonia, delivering 16-19x performance improvements over pure Python implementations.

Version: 2.0.0

Generated on 2025-10-06 17:10:21

Total content: 6 rules, 3 sections

## Dual Testing Strategy

**Priority:** critical

Python tests in tests/ validate API and integration. Rust tests in crates/ validate core logic. Use pytest for Python tests, cargo test for Rust tests. Maintain dual coverage with pytest-cov and cargo-llvm-cov.

## Rust Core Architecture

**Priority:** critical

Core conversion logic is in Rust. Python bindings expose the API via PyO3. Python code should be minimal wrappers around Rust functions. Rust code in crates/html-to-markdown/ implements the conversion engine using html5ever parser and ammonia sanitizer.

## Type Safety

**Priority:** critical

Use Python 3.10+ type hints for Python wrapper code. Rust code uses standard Rust types. Python type stubs in \_rust.pyi provide type information for Rust bindings. Test both Python API and Rust implementation separately.

## Build System

**Priority:** high

Build Python package with maturin via uv pip install -e . (triggers maturin automatically). Maturin is configured in pyproject.toml [tool.maturin] section. Build CLI binary with cargo build --release --package html-to-markdown-cli.

## Code Quality with Prek

**Priority:** high

Use prek (not pre-commit) for pre-commit hooks. Format Python with ruff, Rust with cargo fmt. Lint Python with ruff, Rust with clippy. Run prek run --all-files to check everything. Install hooks with prek install && prek install --hook-type commit-msg.

## Prerequisites

- Python 3.10+
- Rust 1.75+ (stable)
- uv package manager
- Task (task runner)
- prek (pre-commit hooks)

## Quick Setup

```bash
# Clone and setup
git clone https://github.com/Goldziher/html-to-markdown.git
cd html-to-markdown
task setup
```

## Running Tests

```bash
# Python tests
task test:python

# Rust tests
task test:rust

# Both
task test

# With coverage
task cov:all
```

## Development

```bash
# Build Rust components
task build

# Format code
task fmt

# Run linters
task lint

# Run benchmarks
task bench
```

## Task Runner Commands

**Priority:** high

Use Taskfile for development tasks. Run task setup for initial setup, task update for dependency updates, task build for development builds. See Taskfile.yaml for all available commands.

## Project Structure

```text
crates/
â”œâ”€â”€ html-to-markdown/       # Core Rust library
â”œâ”€â”€ html-to-markdown-py/    # Python bindings (PyO3)
â””â”€â”€ html-to-markdown-cli/   # Native CLI binary
html_to_markdown/
â”œâ”€â”€ api.py                  # Python API
â”œâ”€â”€ options.py              # Configuration dataclasses
â”œâ”€â”€ v1_compat.py           # v1 compatibility layer
â””â”€â”€ _rust.pyi              # Type stubs
tests/                      # Python integration tests
```

## Rust Crates

- **html-to-markdown**: Core conversion logic with html5ever
- **html-to-markdown-py**: PyO3 bindings for Python
- **html-to-markdown-cli**: Standalone CLI binary

## Python Package

- Thin wrapper around Rust backend
- v1 compatibility layer for backward compatibility
- Type-safe dataclass configuration

## CI Workflows

- **ci.yaml**: Main CI with Rust tests, Python tests, coverage, linting
- **test-wheels.yaml**: Build and test wheels across platforms

## Coverage

- Rust: cargo-llvm-cov generates rust-coverage.lcov
- Python: pytest-cov generates coverage.lcov
- Upload both to coverage service

## Testing Matrix

- Python: 3.10, 3.12, 3.14-dev
- OS: Linux, macOS, Windows
- Rust tests run on all platforms

## Prek Configuration

- .prek-config.yaml contains hook configuration
- Hooks run ruff, clippy, cargo fmt, mypy
- Install with prek install (not pre-commit install)
