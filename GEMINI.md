<!--
ðŸ¤– GENERATED FILE - DO NOT EDIT DIRECTLY
===========================================

This file was automatically generated by ai-rulez from ai-rulez.yaml.

âš ï¸  IMPORTANT FOR AI ASSISTANTS AND DEVELOPERS:
- DO NOT modify this file directly
- DO NOT add, remove, or change rules in this file
- Changes made here will be OVERWRITTEN on next generation

âœ… TO UPDATE RULES:
1. Edit the source configuration: ai-rulez.yaml
2. Regenerate this file: ai-rulez generate
3. The updated GEMINI.md will be created automatically

ðŸ“ Generated: 2025-11-02 12:41:00
ðŸ“ Source: ai-rulez.yaml
ðŸŽ¯ Target: GEMINI.md
ðŸ“Š Content: 6 rules, 3 sections

Learn more: https://github.com/Goldziher/ai-rulez
===========================================
-->

# html-to-markdown

High-performance HTML to Markdown converter with a Rust core plus Python, TypeScript, and Ruby distribution packages.

Version: 2.0.0

Generated on 2025-11-02 12:41:00

Total content: 6 rules, 3 sections

## Dual Testing Strategy

**Priority:** critical

Python tests in packages/python/tests validate API and integration. Rust tests in crates/ validate core logic. TypeScript tests live in packages/typescript/tests and Ruby specs in packages/ruby/spec. Use pytest, vitest, rspec, and cargo test respectively. Maintain dual coverage with pytest-cov and cargo-llvm-cov.

## Rust Core Architecture

**Priority:** critical

Core conversion logic is in Rust. Python bindings expose the API via PyO3. Python code should be minimal wrappers around Rust functions. Rust code in crates/html-to-markdown/ implements the conversion engine using html5ever parser and ammonia sanitizer.

## Type Safety

**Priority:** critical

Use Python 3.10+ type hints for Python wrapper code. Rust code uses standard Rust types. Python type stubs in _rust.pyi provide type information for Rust bindings. Test both Python API and Rust implementation separately.

## Build System

**Priority:** high

Build Python package with maturin via uv pip install -e packages/python. TypeScript package builds with pnpm run build in packages/typescript (after the Node bindings build), Ruby gem uses bundle exec rake spec/package in packages/ruby, and the CLI binary builds with cargo build --release --package html-to-markdown-cli.

## Code Quality with Prek

**Priority:** high

Use prek (not pre-commit) for pre-commit hooks. Format Python with ruff, Rust with cargo fmt. Lint Python with ruff, Rust with clippy. Run prek run --all-files to check everything. Install hooks with prek install && prek install --hook-type commit-msg.

## Prerequisites
- Python 3.10+
- Rust 1.75+ (stable)
- uv package manager
- Task (task runner)
- prek (pre-commit hooks)

## Quick Setup
```bash
# Clone and setup
git clone https://github.com/Goldziher/html-to-markdown.git
cd html-to-markdown
task setup
```

## Running Tests
```bash
# Python tests
task test:python

# Rust tests
task test:rust

# Both
task test

# With coverage
task cov:all
```

## Development
```bash
# Build Rust components
task build

# Format code
task fmt

# Run linters
task lint

# Run benchmarks
task bench
```

## Task Runner Commands

**Priority:** high

Use Taskfile for development tasks. Run task setup for initial setup, task update for dependency updates, task build for development builds, and task test:* for language-specific suites. See Taskfile.yaml for all available commands.

## Project Structure
```
crates/
â”œâ”€â”€ html-to-markdown/        # Core Rust library
â”œâ”€â”€ html-to-markdown-cli/    # Native CLI binary
â”œâ”€â”€ html-to-markdown-node/   # NAPI bindings for Node.js/Bun
â”œâ”€â”€ html-to-markdown-wasm/   # wasm-bindgen bindings
â””â”€â”€ html-to-markdown-py/     # PyO3 bindings used by Python package
packages/
â”œâ”€â”€ python/                  # PyPI distribution (html_to_markdown package + tests)
â”œâ”€â”€ typescript/              # npm distribution + CLI wrapper
â””â”€â”€ ruby/                    # Ruby gem sources and specs
scripts/                     # Helper scripts (wheel prep, gem prep, demo build)
```

## Rust Crates
- **html-to-markdown**: Core conversion logic with html5ever + ammonia
- **html-to-markdown-node**: Native Node.js bindings (NAPI-RS)
- **html-to-markdown-wasm**: WebAssembly bindings
- **html-to-markdown-py**: PyO3 bindings consumed by Python package
- **html-to-markdown-cli**: Standalone CLI binary

## Distribution Packages
- **packages/python**: PyPI package with Python API and tests
- **packages/typescript**: npm package + CLI built on Node bindings
- **packages/ruby**: Ruby gem using Magnus bindings

## CI Workflows
- **ci.yaml**: Main CI running Rust, Python, Ruby, Node, TypeScript, and WASM tests plus linting/formatting
- **test-wheels.yaml**: Build and test Python wheels across platforms

## Coverage
- Rust: cargo-llvm-cov generates rust-coverage.lcov
- Python: pytest-cov generates coverage.lcov
- Upload artifacts from CI when needed

## Testing Matrix
- Python: 3.10, 3.12, 3.14-dev
- OS: Linux, macOS, Windows
- Rust tests run on all platforms; TypeScript and Ruby test on Unix + Windows where supported

## Prek Configuration
- .prek-config.yaml contains hook configuration
- Hooks run ruff, clippy, cargo fmt, mypy
- Install with prek install (not pre-commit install)
