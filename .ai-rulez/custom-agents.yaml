# HTML-to-Markdown Custom Agents
# Domain-specific agent definitions for HTML parsing, conversion algorithms, and security
# These agents extend the base ai-rulez agents with specialized expertise for this project
#
# Schema: ai-rules-v3
# Integration: Extends shared ai-rulez agents for HTML-to-Markdown conversion pipeline
# Last Updated: 2025-12-29

---

# =============================================================================
# HTML-TO-MARKDOWN CONVERSION AGENTS
# =============================================================================
# These agents focus on HTML5 parsing, markdown conversion algorithms,
# and security/sanitization unique to the conversion pipeline.

agents:
  # =========================================================================
  # HTML PARSING & DOM TRAVERSAL SPECIALIST
  # =========================================================================

  - name: html-parsing-specialist
    model: haiku
    description: |
      HTML parsing and DOM traversal expert specializing in robust HTML5 parsing,
      tree walking, element extraction, and DOM normalization. Designs and implements
      HTML parsing logic, handles edge cases in DOM traversal, optimizes parsing
      performance for large documents, and debugs HTML parsing issues.

      Expertise: html5ever parser internals, DOM walking algorithms, HTML structure
      validation, character encoding issues, whitespace normalization, HTML entity
      handling and encoding, nested structure analysis. Consults with
      markdown-conversion-specialist for formatting decisions and
      safety-sanitization-specialist for security concerns.

    scope:
      - HTML5 parsing with html5ever crate
      - DOM tree traversal and node handling
      - Element extraction and selector logic
      - Whitespace normalization and HTML entity handling
      - HTML structure validation and character encoding
      - Nested structure analysis

  # =========================================================================
  # MARKDOWN CONVERSION ALGORITHM SPECIALIST
  # =========================================================================

  - name: markdown-conversion-specialist
    model: haiku
    description: |
      Markdown conversion rules and algorithm expert specializing in conversion logic,
      markdown formatting rules, and content transformation. Designs conversion
      algorithms for HTML elements, defines markdown formatting rules, handles complex
      element combinations, and optimizes output readability.

      Expertise: CommonMark specification, HTML semantic mapping, conversion edge cases,
      output optimization, markdown syntax and formatting rules, HTML-to-Markdown
      mapping strategies, reference link generation, code block handling, table
      conversion, list normalization. Consults with html-parsing-specialist for DOM
      structure insights and safety-sanitization-specialist for safe content handling.

    scope:
      - Markdown syntax and formatting rules
      - HTML-to-Markdown mapping strategies
      - Content transformation algorithms
      - Reference link generation
      - Code block handling and table conversion
      - List normalization and output optimization

  # =========================================================================
  # SECURITY & SANITIZATION ARCHITECT
  # =========================================================================

  - name: safety-sanitization-specialist
    model: sonnet
    description: |
      XSS prevention and validation architect specializing in security-critical
      sanitization design and vulnerability prevention. Designs sanitization
      architecture, defines security policies, reviews safety-critical code,
      audits for vulnerabilities, and documents security assumptions. Responsible
      for ensuring all HTML content is sanitized before conversion and validating
      output for XSS safety.

      Expertise: XSS attack vectors and prevention, HTML sanitization with ammonia
      crate, input validation strategies, content security policies, script/style
      handling, dangerous attribute removal, protocol validation (href, src, etc.),
      OWASP security guidelines, HTML security best practices, Unicode/encoding
      attacks. Works with html-parsing-specialist on DOM safety, with
      markdown-conversion-specialist on output safety, and leads security reviews
      before releases.

    scope:
      - XSS attack vector analysis and prevention
      - HTML sanitization with ammonia crate
      - Input validation strategies
      - Content security policies
      - Script/style handling and dangerous attribute removal
      - Protocol validation and security policy definition

# =============================================================================
# AGENT WORKFLOW
# =============================================================================
#
# The three specialists work together in this conversion pipeline:
#
# 1. html-parsing-specialist
#    - Parse HTML with html5ever
#    - Validate structure and normalize whitespace
#    - Coordinate with safety-sanitization-specialist on DOM safety
#
# 2. safety-sanitization-specialist
#    - Sanitize parsed DOM with ammonia
#    - Remove XSS vectors and dangerous attributes
#    - Review safety assumptions throughout pipeline
#
# 3. markdown-conversion-specialist
#    - Convert sanitized DOM to markdown
#    - Apply formatting rules and optimization
#    - Validate output readability
#
# 4. safety-sanitization-specialist (final review)
#    - Validate output markdown for residual XSS risk
#    - Ensure all dangerous protocols removed
#    - Approve conversion for release

# =============================================================================
# AGENT COORDINATION PATTERNS
# =============================================================================
#
# html-parsing-specialist ↔ safety-sanitization-specialist
#   - DOM safety concerns flagged during parsing
#   - Coordination on entity handling and encoding safety
#
# safety-sanitization-specialist ↔ markdown-conversion-specialist
#   - Sanitized DOM provided for conversion
#   - Output validation for residual security issues
#
# All agents ↔ shared ai-rulez agents
#   - Extend base Rust core and architecture engineers
#   - Follow shared naming conventions and patterns
