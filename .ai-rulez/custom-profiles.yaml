# HTML-to-Markdown Custom Profiles
# Domain-specific profiles that extend the shared conversion-library.yaml profile
# Adds html-to-markdown-specific agents, rules, domains, and skills

# Primary Profile: HTML-to-Markdown Conversion Library
# Extends conversion-library.yaml from shared ai-rulez
html-to-markdown-conversion:
  name: "HTML-to-Markdown Conversion Library"
  description: "High-performance HTMLâ†’Markdown converter with Rust core and polyglot bindings. Specialized for HTML parsing, markdown conversion algorithms, and security-first design."

  # Extends the base conversion-library profile
  extends: "conversion-library"

  # Additional domains specific to html-to-markdown
  additional_domains:
    - html-parsing          # New domain for HTML parsing expertise
    - markdown-conversion   # New domain for conversion logic
    - security-sanitization # New domain for XSS prevention and validation

  # Specialized agents for this project
  # These extend and override the default conversion-library agents
  agents:
    # Architecture & Strategy (Sonnet - complex decisions)
    - polyglot-architect              # Sonnet: conversion architecture
    - safety-sanitization-specialist  # Sonnet: XSS prevention & security design

    # HTML Parsing & DOM (Haiku - fast implementation)
    - html-parsing-specialist         # Haiku: HTML parsing & DOM traversal
    - markdown-conversion-specialist  # Haiku: conversion rules & algorithms

    # Core Implementation (Haiku - fast coding)
    - rust-core-engineer              # Haiku: Rust core implementation
    - python-bindings-engineer        # Haiku: Python/PyO3 bindings
    - typescript-bindings-engineer    # Haiku: TypeScript/NAPI-RS bindings
    - ruby-bindings-engineer          # Haiku: Ruby/Magnus bindings
    - php-bindings-engineer           # Haiku: PHP/ext-php-rs bindings

    # Testing & Quality (Haiku)
    - test-automation-engineer        # Haiku: E2E conversion tests
    - code-reviewer                   # Haiku: Multi-language review

    # Documentation (Haiku)
    - docs-writer                     # Haiku: Conversion guides
    - api-doc-writer                  # Haiku: API references
    - tutorial-writer                 # Haiku: Conversion tutorials

  # HTML-to-Markdown specific rules
  priority_rules:
    # Inherited from conversion-library
    - rust-2024-edition-core-conversion-engine
    - python-310-pyo3-binding-wrappers
    - typescript-5x-napi-rs-bindings-cli
    - ruby-32-magnus-native-bindings-with-rbs
    - php-82-ext-php-rs-extension-composer-package
    - polyglot-build-system-distribution
    - dual-testing-strategy-core-bindings
    - continuous-integration-coverage
    - code-quality
    - code-quality-with-prek

    # Additional html-to-markdown specific rules
    - html-parsing-robust-error-handling
    - markdown-conversion-accuracy-verification
    - xss-prevention-security-validation
    - fixture-driven-integration-testing

  # Model routing for html-to-markdown specific task types
  model_routing:
    # Architecture decisions - Sonnet
    architecture_decisions: sonnet
    security_design: sonnet

    # Implementation - Haiku
    core_implementation: haiku
    binding_implementation: haiku
    html_parsing: haiku
    conversion_algorithm: haiku
    testing: haiku
    code_review: haiku
    documentation: haiku

  # Specialized skills for html-to-markdown
  skills:
    parsing:
      - html5-parsing-optimization
      - dom-traversal-algorithms
      - whitespace-normalization
      - encoding-handling

    conversion:
      - html-to-markdown-mapping
      - markdown-formatting-rules
      - reference-link-generation
      - table-and-list-conversion
      - code-block-handling

    security:
      - ammonia-sanitization-configuration
      - xss-vector-identification
      - dangerous-attribute-removal
      - protocol-validation
      - unicode-attack-prevention

    testing:
      - html-fixture-generation
      - conversion-accuracy-validation
      - cross-language-integration-testing
      - performance-benchmarking

    documentation:
      - html-parsing-guide
      - conversion-algorithm-documentation
      - security-architecture-docs
      - language-binding-guides
      - performance-tuning-guide

  # HTML-to-markdown specific quality gates
  quality_gates:
    # Inherit base quality gates from conversion-library
    rust_coverage_minimum: 95
    binding_coverage_minimum: 80

    # HTML parsing accuracy: fixture-based validation
    html_parsing_accuracy: 99.5  # Percentage of fixtures passing

    # Markdown output validation
    markdown_output_validation: true  # Validate against CommonMark spec
    xss_prevention_validation: true   # Security test suite required

    # Performance thresholds
    performance:
      html_parsing_speed: 10000  # chars/ms minimum throughput
      conversion_latency: 100    # ms maximum for typical documents

  # Domain-specific configuration
  domain_config:
    # HTML Parsing Domain
    html-parsing:
      description: "HTML5 parsing and DOM traversal"
      tools: [html5ever, encoding_rs]
      testing_strategy: "fixture-based with real HTML samples"

    # Markdown Conversion Domain
    markdown-conversion:
      description: "HTML to Markdown conversion algorithms"
      tools: [thiserror, regex]
      testing_strategy: "parametrized tests with conversion fixtures"
      reference_spec: "CommonMark 0.30"

    # Security Domain
    security-sanitization:
      description: "XSS prevention and content sanitization"
      tools: [ammonia]
      testing_strategy: "OWASP attack vector validation"
      audit_frequency: "per-release"

  # Development workflow for html-to-markdown
  workflow:
    phases:
      - name: "Setup"
        command: "task setup"
        purpose: "Install all language dependencies"

      - name: "Development"
        commands:
          - "task lint"       # Auto-fix formatting & lint
          - "task test"       # Run all tests
          - "git commit"      # Commit with prek hooks

      - name: "Testing"
        commands:
          - "task test:ci"    # Full CI test suite
          - "task cov:all"    # Generate coverage reports

      - name: "Review"
        commands:
          - "task lint:check" # Verify code quality
          - "code-reviewer evaluation"

      - name: "Integration"
        commands:
          - "task build"      # Build all bindings
          - "task e2e:test:all" # End-to-end tests

# Secondary Profile: HTML Parsing Focused (For parsing-heavy work)
html-to-markdown-parsing-focus:
  name: "HTML Parsing Specialist Profile"
  description: "Focused profile for HTML parsing optimization and debugging"
  extends: "html-to-markdown-conversion"

  primary_agents:
    - html-parsing-specialist
    - safety-sanitization-specialist
    - test-automation-engineer

  model_routing:
    html_parsing: haiku
    security_validation: sonnet
    testing: haiku

# Secondary Profile: Security & Sanitization Focused
html-to-markdown-security-focus:
  name: "Security & Sanitization Specialist Profile"
  description: "Focused profile for security audit and sanitization design"
  extends: "html-to-markdown-conversion"

  primary_agents:
    - safety-sanitization-specialist
    - html-parsing-specialist
    - code-reviewer

  model_routing:
    security_design: sonnet
    html_parsing: haiku
    code_review: haiku

# Secondary Profile: Conversion Algorithm Focused
html-to-markdown-algorithm-focus:
  name: "Conversion Algorithm Specialist Profile"
  description: "Focused profile for markdown conversion logic and accuracy"
  extends: "html-to-markdown-conversion"

  primary_agents:
    - markdown-conversion-specialist
    - html-parsing-specialist
    - test-automation-engineer

  model_routing:
    conversion_algorithm: haiku
    html_parsing: haiku
    testing: haiku
