skills:
  - name: heading-conversion
    context: Convert HTML heading tags to Markdown
    key_source_files:
      - crates/html-to-markdown/src/converter.rs (convert_heading)
    master_concepts:
      - ATX style (#)
      - Setext style (underline)
      - HeadingStyle configuration
      - Content preservation
    step_by_step: |
      1. Extract heading level from h1, h2, etc.
      2. Extract heading text content
      3. Check HeadingStyle option
         a. ATX mode generates # h1 or ## h2 etc.
         b. Setext mode generates underlines for h1 and h2
      4. Preserve inline formatting (bold, italic, links)
      5. Add blank line after heading
    skills_involved:
      - content-extraction
      - markdown-formatting
      - option-application
    when_to_use: Converting any heading element

  - name: paragraph-conversion
    context: Convert paragraph tags to Markdown
    key_source_files:
      - crates/html-to-markdown/src/converter.rs (convert_p)
    master_concepts:
      - Content extraction
      - Inline formatting preservation
      - Blank line separation
      - Whitespace handling
    step_by_step: |
      1. Extract paragraph content
      2. Process inline formatting
         - Bold: convert strong tags to **text**
         - Italic: convert em tags to *text*
         - Links: convert a tags to [text](href)
      3. Handle line breaks within paragraph
      4. Trim excessive whitespace
      5. Add blank line after paragraph
    skills_involved:
      - content-extraction
      - inline-element-conversion
      - markdown-formatting
    when_to_use: Converting <p> tags

  - name: list-conversion-and-nesting
    context: Convert HTML lists to Markdown lists with proper nesting
    key_source_files:
      - crates/html-to-markdown/src/converter.rs (convert_list)
    master_concepts:
      - Unordered vs ordered lists
      - List item processing
      - Nesting and indentation
      - Tight vs loose detection
    step_by_step: |
      1. Identify list type (ul or ol)
      2. Process each list item
         a. Extract item content
         b. Process nested lists recursively
      3. Determine indentation level
      4. Choose bullet/number style
         - ul uses -, *, or + per option
         - ol uses 1., 2., etc.
      5. Detect tight/loose list formatting
         - Tight means no blank lines between items
         - Loose means blank lines between items
      6. Format output with proper indentation
    skills_involved:
      - recursion-handling
      - indentation-management
      - list-structure-analysis
    when_to_use: Converting <ul>, <ol>, <li> elements

  - name: table-conversion
    context: Convert HTML tables to Markdown GFM pipe tables
    key_source_files:
      - crates/html-to-markdown/src/converter.rs (convert_table)
    master_concepts:
      - Table structure (thead, tbody, tfoot)
      - Cell content and alignment
      - GFM pipe format
      - Header detection
    step_by_step: |
      1. Extract table structure
         - Headers from thead or th elements
         - Data from tbody or td elements
      2. Collect column alignments
         - Extract from align attribute or CSS
         - Map to left, center, or right
      3. Generate header row with pipes and content
      4. Generate separator row with dashes and colons
         - dashes only for left alignment
         - dashes with colons for center
         - dashes with right colon for right
      5. Generate data rows with proper escaping
      6. Handle edge cases
         - Missing cells are filled with empty space
         - Pipe in content is escaped with backslash
    skills_involved:
      - table-structure-analysis
      - alignment-detection
      - pipe-escaping
    when_to_use: Converting <table> elements

  - name: link-conversion
    context: Convert HTML links to Markdown format
    key_source_files:
      - crates/html-to-markdown/src/converter.rs (convert_link)
    master_concepts:
      - href extraction
      - Link text processing
      - Title attribute handling
      - URL sanitization
    step_by_step:
      1. Extract href attribute
      2. Sanitize URL with sanitize_url()
      3. Extract link text
      4. Check for title attribute
      5. Format as [text] with href in parentheses
      6. Handle edge cases
         - No href means treat as plain text
         - No text means use href as text
         - Fragment URLs preserve anchor
    skills_involved:
      - url-extraction
      - url-sanitization
      - markdown-formatting
    when_to_use: Converting <a> elements

  - name: image-conversion
    context: Convert HTML images to Markdown format
    key_source_files:
      - crates/html-to-markdown/src/converter.rs (convert_image)
    master_concepts:
      - src extraction
      - alt text handling
      - Responsive images (srcset)
      - Title attribute
    step_by_step: |
      1. Extract src attribute
      2. Sanitize URL
      3. Extract alt text or use filename if no alt
      4. Check for title attribute
      5. Format as ![alt] with src in parentheses
      6. Handle responsive images
         - Check srcset attribute
         - Use best-fit source
      7. Handle data URIs if configured
    skills_involved:
      - url-extraction
      - alt-text-handling
      - responsive-image-processing
    when_to_use: Converting <img> elements

  - name: emphasis-and-formatting-conversion
    context: Convert text emphasis tags to Markdown
    key_source_files:
      - crates/html-to-markdown/src/converter.rs
    master_concepts:
      - Bold/strong formatting
      - Italic/emphasis formatting
      - Strikethrough
      - Nested emphasis
      - Escaping rules
    step_by_step:
      1. For strong tags wrap with double asterisks
      2. For em tags wrap with single asterisk
      3. For del/s tags wrap with double tildes
      4. For nested emphasis (bold and italic together)
         a. Detect combination
         b. Use triple asterisks
      5. Avoid double-escaping with too many marks
      6. Preserve content without interpretation
    skills_involved:
      - emphasis-detection
      - formatting-composition
      - escape-management
    when_to_use: Converting emphasis elements

  - name: inline-code-conversion
    context: Convert code elements to Markdown
    key_source_files:
      - crates/html-to-markdown/src/converter.rs
    master_concepts:
      - Backtick wrapping
      - Content preservation
      - Nested code handling
      - Escape rules
    step_by_step: |
      1. Extract code content
      2. Determine backtick count needed
         - No backticks in content means use single backtick
         - Backticks present means use double or more
      3. Wrap code with appropriate backtick count
      4. Preserve content exactly without interpretation
      5. Handle edge cases
         - Code with backticks
         - Code with special characters
         - Code with entity references
    skills_involved:
      - content-preservation
      - backtick-escaping
      - special-char-handling
    when_to_use: Converting <code>, <kbd>, <samp> elements

  - name: markdown-text-escaping
    context: Escape Markdown metacharacters in text
    key_source_files:
      - crates/html-to-markdown/src/text.rs
    master_concepts:
      - Metacharacter identification
      - Escape rules
      - Context-aware escaping
      - Double-escape prevention
    step_by_step: |
      1. Identify Markdown metacharacters
         backslash, asterisk, underscore, backtick, brackets, parens, hash, plus, minus, dot, exclamation, pipe, greater-than, tilde, equals
      2. For each metachar, check if escape needed
         - Before Markdown syntax means escape
         - In code block means no escape
         - In link text means escape
      3. Escape with backslash for literal characters
      4. Verify no double-escaping occurs
      5. Preserve content accuracy
    skills_involved:
      - character-identification
      - context-detection
      - selective-escaping
    when_to_use: Processing text content in conversion

  - name: html-entity-decoding
    context: Decode HTML entities in text
    key_source_files:
      - crates/html-to-markdown/src/text.rs
    master_concepts:
      - Named entities (&nbsp;, &lt;, &amp;)
      - Numeric entities (&#123;, &#x7B;)
      - Partial entity handling
      - Preservation of decoded text
    step_by_step: |
      1. Identify HTML entities
         - Named entities like &name;
         - Decimal entities like &#123;
         - Hex entities like &#x7B;
      2. Decode each entity
         - &nbsp; becomes a space (non-breaking space)
         - &lt; becomes <
         - &gt; becomes >
         - &amp; becomes &
         - &#123; becomes {
      3. Handle partial entities
         - Preserve incomplete entities like & nbsp
         - Preserve invalid entities like &123
      4. Don't re-encode after decoding
    skills_involved:
      - entity-recognition
      - unicode-mapping
      - error-handling
    when_to_use: Processing text content with entities

  - name: whitespace-normalization
    context: Normalize whitespace per configuration
    key_source_files:
      - crates/html-to-markdown/src/options.rs (WhitespaceMode)
    master_concepts:
      - Preserve mode (identity)
      - Minimal mode (trim, normalize internal)
      - Collapse mode (HTML5 rules)
    step_by_step: |
      1. Get WhitespaceMode from options
      2. Apply based on mode
         - Preserve means no change
         - Minimal means trim and normalize
         - Collapse means apply HTML5 rules
      3. HTML5 collapse logic
         a. Replace newline and whitespace with space
         b. Collapse multiple spaces to one
         c. Remove leading and trailing as context-dependent
      4. Preserve line breaks from br tags
    skills_involved:
      - string-manipulation
      - mode-selection
      - whitespace-analysis
    when_to_use: Text processing in conversion

  - name: blockquote-conversion
    context: Convert blockquote elements to Markdown
    key_source_files:
      - crates/html-to-markdown/src/converter.rs
    master_concepts:
      - Block quote prefix (>)
      - Nesting support
      - Content preservation
      - Line-by-line formatting
    step_by_step: |
      1. Extract blockquote content
      2. Split by lines
      3. For each line, prefix with greater-than and space
      4. For nested blockquotes add multiple greater-than markers
      5. Preserve blank lines within blockquote
      6. Handle multi-line content with multiple paragraphs
    skills_involved:
      - line-processing
      - nesting-management
      - prefix-application
    when_to_use: Converting <blockquote> elements

  - name: task-list-detection-and-conversion
    context: Detect and convert checkbox task lists
    key_source_files:
      - crates/html-to-markdown/src/converter.rs
    master_concepts:
      - Checkbox detection
      - Checked state extraction
      - Task list format ([ ] vs [x])
      - Item content processing
    step_by_step: |
      1. For each li element, check for input checkbox
      2. If found
         a. Extract checked attribute
         b. Format as - [ ] text for unchecked
         c. Format as - [x] text for checked
      3. Process list item content normally
      4. Handle mixed task and regular lists
    skills_involved:
      - element-detection
      - attribute-extraction
      - list-formatting
    when_to_use: Converting lists with checkboxes

  - name: semantic-html5-element-conversion
    context: Convert semantic HTML5 elements to Markdown
    key_source_files:
      - crates/html-to-markdown/src/converter.rs
    master_concepts:
      - Semantic elements (article, section, nav, aside)
      - Conversion strategy (heading vs section marker)
      - Content preservation
    step_by_step: |
      1. Identify semantic element type
      2. Choose conversion strategy
         - article elements convert to optional heading or section
         - section elements convert to optional heading or section
         - nav elements convert to labeled list or section
         - aside elements convert to blockquote or indented section
         - header elements convert to optional heading
         - footer elements convert to optional separator
      3. Apply strategy based on content
      4. Preserve all content
    skills_involved:
      - semantic-understanding
      - strategy-selection
      - content-mapping
    when_to_use: Converting semantic HTML5 elements

  - name: form-element-handling
    context: Convert form elements to Markdown equivalents
    key_source_files:
      - crates/html-to-markdown/src/converter.rs
    master_concepts:
      - Input type detection
      - Label association
      - Fallback formats
    step_by_step:
      1. Identify input type
         - text becomes code block or input notation
         - checkbox becomes task list
         - radio becomes list item with marker
         - hidden is skipped entirely
      2. Extract label from label element or associated text
      3. Convert based on type
         - Text inputs become code block with label
         - Checkbox inputs become task list
         - Select becomes list of options with selection marked
      4. Preserve field structure
    skills_involved:
      - input-type-detection
      - label-extraction
      - fallback-format-selection
    when_to_use: Converting form elements

  - name: code-block-conversion
    context: Convert preformatted and code blocks
    key_source_files:
      - crates/html-to-markdown/src/converter.rs
    master_concepts:
      - Triple backtick format
      - Language annotation
      - Whitespace preservation
      - Indentation style
    step_by_step: |
      1. Extract code content
      2. Check for language hint (class, data-lang)
      3. Determine style of backticks or indentation
      4. If using backticks
         a. Use fence marker
         b. Add language tag if available
         c. Content on next lines
      5. Preserve all whitespace exactly
      6. Escape backticks in content if needed
    skills_involved:
      - code-extraction
      - language-detection
      - whitespace-preservation
    when_to_use: Converting <pre>, <code> blocks

  - name: url-sanitization
    context: Validate and sanitize URLs in links/images
    key_source_files:
      - crates/html-to-markdown/src/safety.rs
    master_concepts:
      - Scheme validation
      - Dangerous URL detection
      - Safe URL formats
    step_by_step: |
      1. Extract URL from href or src
      2. Check for dangerous schemes
         - Block javascript, data, vbscript
      3. Validate safe schemes
         - Allow http, https, mailto, ftp, /, #
      4. For relative URLs pass through
      5. For absolute URLs validate scheme
      6. Return sanitized URL or None
    skills_involved:
      - url-parsing
      - scheme-validation
      - security-checking
    when_to_use: Processing URLs in links and images

  - name: markdown-validation
    context: Validate generated Markdown syntax
    key_source_files:
      - Markdown specification
    master_concepts:
      - Valid Markdown syntax
      - Structure preservation
      - Roundtrip testing
    step_by_step: |
      1. Generate Markdown from HTML
      2. Parse with Markdown validator
      3. Check for syntax errors
      4. Verify structure (headings, lists, tables)
      5. Round-trip test: Markdown to HTML to Markdown
      6. Compare original vs roundtrip result
    skills_involved:
      - markdown-parsing
      - structure-analysis
      - comparison
    when_to_use: Testing conversion output quality
