The visitor pattern enables custom HTML→Markdown conversion logic by providing callbacks for specific HTML elements during traversal. Use visitors to transform content, filter elements, validate structure, or collect analytics.

**Use Cases:**
- **Custom Markdown dialects** – Convert to Obsidian, Notion, or other flavors
- **Content filtering** – Remove tracking pixels, ads, or unwanted elements
- **URL rewriting** – Rewrite CDN URLs, add query parameters, validate links
- **Accessibility validation** – Check alt text, heading hierarchy, link text
- **Analytics** – Track element usage, link destinations, image sources

**Supported Visitor Methods:** 40+ callbacks for text, inline elements, links, images, headings, lists, blocks, and tables.

### Example: Quick Start

{% if language == 'python' %}
```python
from html_to_markdown import convert_with_visitor

class MyVisitor:
    def visit_link(self, ctx, href, text, title):
        # Rewrite CDN URLs
        if href.startswith("https://old-cdn.com"):
            href = href.replace("https://old-cdn.com", "https://new-cdn.com")
        return {"type": "custom", "output": f"[{text}]({href})"}

    def visit_image(self, ctx, src, alt, title):
        # Skip tracking pixels
        if "tracking" in src:
            return {"type": "skip"}
        return {"type": "continue"}

html = '<a href="https://old-cdn.com/file.pdf">Download</a>'
markdown = convert_with_visitor(html, visitor=MyVisitor())
```

Async support:
```python
import asyncio
from html_to_markdown import convert_with_async_visitor

class AsyncVisitor:
    async def visit_link(self, ctx, href, text, title):
        is_valid = await validate_url(href)
        if not is_valid:
            return {"type": "error", "message": f"Broken link: {href}"}
        return {"type": "continue"}

markdown = await convert_with_async_visitor(html, visitor=AsyncVisitor())
```

{% elif language == 'typescript' %}
```typescript
import { convertWithVisitor, type Visitor, type NodeContext, type VisitResult } from 'html-to-markdown';

const visitor: Visitor = {
  visitLink(ctx: NodeContext, href: string, text: string, title?: string): VisitResult {
    // Rewrite CDN URLs
    if (href.startsWith('https://old-cdn.com')) {
      href = href.replace('https://old-cdn.com', 'https://new-cdn.com');
    }
    return { type: 'custom', output: `[${text}](${href})` };
  },

  visitImage(ctx: NodeContext, src: string, alt?: string, title?: string): VisitResult {
    // Skip tracking pixels
    if (src.includes('tracking')) {
      return { type: 'skip' };
    }
    return { type: 'continue' };
  },
};

const html = '<a href="https://old-cdn.com/file.pdf">Download</a>';
const markdown = convertWithVisitor(html, { visitor });
```

Async support:
```typescript
import { convertWithAsyncVisitor, type AsyncVisitor } from 'html-to-markdown';

const asyncVisitor: AsyncVisitor = {
  async visitLink(ctx, href, text, title) {
    const isValid = await validateUrl(href);
    return isValid ? { type: 'continue' } : { type: 'error', message: `Broken link: ${href}` };
  },
};

const markdown = await convertWithAsyncVisitor(html, { visitor: asyncVisitor });
```

{% elif language == 'ruby' %}
```ruby
require 'html_to_markdown'

class MyVisitor
  def visit_link(ctx, href, text, title = nil)
    # Rewrite CDN URLs
    if href.start_with?('https://old-cdn.com')
      href = href.sub('https://old-cdn.com', 'https://new-cdn.com')
    end
    { type: :custom, output: "[#{text}](#{href})" }
  end

  def visit_image(ctx, src, alt = nil, title = nil)
    # Skip tracking pixels
    src.include?('tracking') ? { type: :skip } : { type: :continue }
  end
end

html = '<a href="https://old-cdn.com/file.pdf">Download</a>'
markdown = HtmlToMarkdown.convert_with_visitor(html, visitor: MyVisitor.new)
```

{% elif language == 'php' %}
```php
<?php
use HtmlToMarkdown\Converter;

readonly class MyVisitor {
    public function visitLink(array $ctx, string $href, string $text, ?string $title): array {
        // Rewrite CDN URLs
        if (str_starts_with($href, 'https://old-cdn.com')) {
            $href = str_replace('https://old-cdn.com', 'https://new-cdn.com', $href);
        }
        return ['type' => 'custom', 'output' => "[{$text}]({$href})"];
    }

    public function visitImage(array $ctx, string $src, ?string $alt, ?string $title): array {
        // Skip tracking pixels
        return str_contains($src, 'tracking') ? ['type' => 'skip'] : ['type' => 'continue'];
    }
}

$html = '<a href="https://old-cdn.com/file.pdf">Download</a>';
$markdown = Converter::convertWithVisitor($html, new MyVisitor());
```

{% elif language == 'go' %}
```go
package main

import (
    "fmt"
    htm "github.com/kreuzberg-dev/html-to-markdown/packages/go/v2/htmltomarkdown"
)

type MyVisitor struct{}

func (v *MyVisitor) VisitLink(ctx *htm.NodeContext, href, text, title string) htm.VisitResult {
    // Rewrite CDN URLs
    if strings.HasPrefix(href, "https://old-cdn.com") {
        href = strings.ReplaceAll(href, "https://old-cdn.com", "https://new-cdn.com")
    }
    return htm.Custom(fmt.Sprintf("[%s](%s)", text, href))
}

func (v *MyVisitor) VisitImage(ctx *htm.NodeContext, src, alt, title string) htm.VisitResult {
    // Skip tracking pixels
    if strings.Contains(src, "tracking") {
        return htm.Skip()
    }
    return htm.Continue()
}

html := `<a href="https://old-cdn.com/file.pdf">Download</a>`
markdown, _ := htm.ConvertWithVisitor(html, &MyVisitor{}, nil)
```

{% elif language == 'java' %}
```java
import dev.kreuzberg.htmltomarkdown.Converter;
import dev.kreuzberg.htmltomarkdown.Visitor;
import dev.kreuzberg.htmltomarkdown.VisitResult;

public class MyVisitor implements Visitor {
    @Override
    public VisitResult visitLink(NodeContext ctx, String href, String text, String title) {
        // Rewrite CDN URLs
        if (href.startsWith("https://old-cdn.com")) {
            href = href.replace("https://old-cdn.com", "https://new-cdn.com");
        }
        return VisitResult.custom(String.format("[%s](%s)", text, href));
    }

    @Override
    public VisitResult visitImage(NodeContext ctx, String src, String alt, String title) {
        // Skip tracking pixels
        return src.contains("tracking") ? VisitResult.skip() : VisitResult.continue();
    }
}

String html = "<a href=\"https://old-cdn.com/file.pdf\">Download</a>";
String markdown = Converter.convertWithVisitor(html, new MyVisitor());
```

{% elif language == 'csharp' %}
```csharp
using KreuzbergDev.HtmlToMarkdown;

public class MyVisitor : IVisitor {
    public VisitResult VisitLink(NodeContext ctx, string href, string text, string? title) {
        // Rewrite CDN URLs
        if (href.StartsWith("https://old-cdn.com")) {
            href = href.Replace("https://old-cdn.com", "https://new-cdn.com");
        }
        return VisitResult.Custom($"[{text}]({href})");
    }

    public VisitResult VisitImage(NodeContext ctx, string src, string? alt, string? title) {
        // Skip tracking pixels
        return src.Contains("tracking") ? VisitResult.Skip() : VisitResult.Continue();
    }
}

var html = "<a href=\"https://old-cdn.com/file.pdf\">Download</a>";
var markdown = Converter.ConvertWithVisitor(html, new MyVisitor());
```

{% elif language == 'elixir' %}
```elixir
defmodule MyVisitor do
  def visit_link(ctx, href, text, title) do
    # Rewrite CDN URLs
    href = if String.starts_with?(href, "https://old-cdn.com") do
      String.replace(href, "https://old-cdn.com", "https://new-cdn.com")
    else
      href
    end
    {:custom, "[#{text}](#{href})"}
  end

  def visit_image(ctx, src, alt, title) do
    # Skip tracking pixels
    if String.contains?(src, "tracking") do
      :skip
    else
      :continue
    end
  end
end

html = "<a href=\"https://old-cdn.com/file.pdf\">Download</a>"
markdown = HtmlToMarkdown.convert_with_visitor(html, visitor: MyVisitor)
```

{% endif %}

For comprehensive examples including content filtering, link footnotes, accessibility validation, and asynchronous URL validation, see the [Visitor Pattern Guide](../../examples/visitor-pattern/).
